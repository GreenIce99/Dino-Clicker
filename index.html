<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dino Clicker 🦖 - Dino Power Upgrades & Leaderboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #a8edea, #fed6e3);
    text-align: center;
    padding: 30px;
    color: #2e7d32;
    user-select: none;
    max-width: 600px;
    margin: auto;
  }
  h1 {
    font-size: 48px;
    margin-bottom: 0;
  }
  #score, #highscore {
    font-size: 32px;
    margin: 10px 0;
  }
  .button {
    background-color: #4caf50;
    border: none;
    color: white;
    padding: 15px 25px;
    margin: 10px;
    font-size: 18px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px #388e3c;
    transition: all 0.2s ease;
    user-select: none;
  }
  .button:active {
    box-shadow: 0 2px #388e3c;
    transform: translateY(3px);
  }
  #upgrades {
    margin-top: 30px;
    text-align: left;
  }
  .upgrade-item {
    margin-bottom: 15px;
  }
  #leaderboard {
    margin-top: 40px;
    text-align: left;
  }
  #leaderboard h2 {
    margin-bottom: 10px;
  }
  #leaderboard ol {
    padding-left: 20px;
  }
  #nameInput {
    font-size: 18px;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-right: 10px;
  }
  #submitMessage {
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Dino Clicker 🦖</h1>
<div id="score">Bones Collected: 0</div>
<div id="highscore">Personal Highscore: 0</div>

<button class="button" id="clickButton">🦖 STOMP the Dino!</button>

<div id="upgrades">
  <h2>Dino Upgrades</h2>
  <div class="upgrade-item"><button class="button" id="upgradeClawPower">+1 Claw Power (<span id="costClawPower">10</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyBabyHelper">Baby Dino Helper (Auto-Stomp) (<span id="costBabyHelper">50</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyRaptorRage">Raptor Rage x2 Multiplier (<span id="costRaptorRage">100</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyTRexBite">T-Rex Bite +5 Power (<span id="costTRexBite">300</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyDinoHerd">Dino Herd Auto-Stomp x5 (<span id="costDinoHerd">1000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyAncientRoar">Ancient Dino Roar x5 Multiplier (<span id="costAncientRoar">3000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyMeteorSmash">Meteor Smash +50 Power (<span id="costMeteorSmash">10000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyDinoAlpha">Dino Alpha Bonus +10 Power & Helpers (<span id="costDinoAlpha">25000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyPteroStrike">Pterodactyl Strike x10 Multiplier (<span id="costPteroStrike">70000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyStegoShield">Stegosaurus Shield +200 Power (<span id="costStegoShield">150000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyFossilFuel">Fossil Fuel Auto-Stomp +50 (<span id="costFossilFuel">400000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyMeteorShower">Meteor Shower x20 Multiplier (<span id="costMeteorShower">900000</span> bones)</button></div>
  <div class="upgrade-item"><button class="button" id="buyVolcanoPower">Volcano Power +1000 Click (<span id="costVolcanoPower">2000000</span> bones)</button></div>
</div>

<div id="leaderboard">
  <h2>Dino Leaderboard - Top 5 Stompers</h2>
  <ol id="leaderboardList"></ol>
  <input type="text" id="nameInput" placeholder="Enter your dino name" maxlength="12" />
  <button class="button" id="submitScore">Roar and Submit Score</button>
  <div id="submitMessage"></div>
</div>

<audio id="clickSound" src="https://freesound.org/data/previews/341/341695_5121236-lq.mp3" preload="auto"></audio>
<audio id="upgradeSound" src="https://freesound.org/data/previews/172/172999_324123-lq.mp3" preload="auto"></audio>

<script>
  // --- Game state ---
  let score = 0;
  let clickPower = 1;
  let autoClickers = 0;
  let clickMultiplier = 1;

  // Costs for upgrades
  let costClawPower = 10;
  let costBabyHelper = 50;
  let costRaptorRage = 100;
  let costTRexBite = 300;
  let costDinoHerd = 1000;
  let costAncientRoar = 3000;
  let costMeteorSmash = 10000;
  let costDinoAlpha = 25000;
  let costPteroStrike = 70000;
  let costStegoShield = 150000;
  let costFossilFuel = 400000;
  let costMeteorShower = 900000;
  let costVolcanoPower = 2000000;

  // DOM elements
  const scoreDisplay = document.getElementById('score');
  const highscoreDisplay = document.getElementById('highscore');
  const clickButton = document.getElementById('clickButton');
  const clickSound = document.getElementById('clickSound');
  const upgradeSound = document.getElementById('upgradeSound');
  const leaderboardList = document.getElementById('leaderboardList');
  const nameInput = document.getElementById('nameInput');
  const submitScoreBtn = document.getElementById('submitScore');
  const submitMessage = document.getElementById('submitMessage');

  // Personal highscore saved locally
  let personalHighscore = parseInt(localStorage.getItem('dinoHighscore')) || 0;

  function updateScore() {
    scoreDisplay.textContent = 'Bones Collected: ' + Math.floor(score);
    if (score > personalHighscore) {
      personalHighscore = Math.floor(score);
      localStorage.setItem('dinoHighscore', personalHighscore);
      highscoreDisplay.textContent = 'Personal Highscore: ' + personalHighscore;
    }
  }

  function playClickSound() {
    clickSound.currentTime = 0;
    clickSound.play();
  }
  function playUpgradeSound() {
    upgradeSound.currentTime = 0;
    upgradeSound.play();
  }

  function alertDino(msg) {
    alert("🦖 Dino says: " + msg);
  }

  function clickDino() {
    score += clickPower * clickMultiplier;
    updateScore();
    playClickSound();
  }

  // Buying upgrades
  function buyUpgrade(type) {
    switch(type) {
      case 'clawPower':
        if(score >= costClawPower) {
          score -= costClawPower;
          clickPower += 1;
          costClawPower = Math.floor(costClawPower * 1.5);
          document.getElementById('costClawPower').textContent = costClawPower;
          playUpgradeSound();
          updateScore();
        } else alertDino("You need more bones for Claw Power!");
        break;
      case 'babyHelper':
        if(score >= costBabyHelper) {
          score -= costBabyHelper;
          autoClickers += 1;
          costBabyHelper = Math.floor(costBabyHelper * 2);
          document.getElementById('costBabyHelper').textContent = costBabyHelper;
          playUpgradeSound();
          updateScore();
        } else alertDino("Not enough bones for Baby Dino Helper!");
        break;
      case 'raptorRage':
        if(score >= costRaptorRage) {
          score -= costRaptorRage;
          clickMultiplier *= 2;
          costRaptorRage = Math.floor(costRaptorRage * 3);
          document.getElementById('costRaptorRage').textContent = costRaptorRage;
          playUpgradeSound();
          updateScore();
        } else alertDino("Need more bones for Raptor Rage!");
        break;
      case 'tRexBite':
        if(score >= costTRexBite) {
          score -= costTRexBite;
          clickPower += 5;
          costTRexBite = Math.floor(costTRexBite * 2);
          document.getElementById('costTRexBite').textContent = costTRexBite;
          playUpgradeSound();
          updateScore();
        } else alertDino("More bones needed for T-Rex Bite!");
        break;
      case 'dinoHerd':
        if(score >= costDinoHerd) {
          score -= costDinoHerd;
          autoClickers += 5;
          costDinoHerd = Math.floor(costDinoHerd * 2.5);
          document.getElementById('costDinoHerd').textContent = costDinoHerd;
          playUpgradeSound();
          updateScore();
        } else alertDino("Bones not enough for Dino Herd!");
        break;
      case 'ancientRoar':
        if(score >= costAncientRoar) {
          score -= costAncientRoar;
          clickMultiplier *= 5;
          costAncientRoar = Math.floor(costAncientRoar * 3.5);
          document.getElementById('costAncientRoar').textContent = costAncientRoar;
          playUpgradeSound();
          updateScore();
        } else alertDino("Gather more bones for Ancient Dino Roar!");
        break;
      case 'meteorSmash':
        if(score >= costMeteorSmash) {
          score -= costMeteorSmash;
          clickPower += 50;
          costMeteorSmash = Math.floor(costMeteorSmash * 4);
          document.getElementById('costMeteorSmash').textContent = costMeteorSmash;
          playUpgradeSound();
          updateScore();
        } else alertDino("Not enough bones for Meteor Smash!");
        break;
      case 'dinoAlpha':
        if(score >= costDinoAlpha) {
          score -= costDinoAlpha;
          autoClickers += 10;
          clickPower += 10;
          costDinoAlpha = Math.floor(costDinoAlpha * 4.5);
          document.getElementById('costDinoAlpha').textContent = costDinoAlpha;
          playUpgradeSound();
          updateScore();
        } else alertDino("Bones missing for Dino Alpha Bonus!");
        break;
      case 'pteroStrike':
        if(score >= costPteroStrike) {
          score -= costPteroStrike;
          clickMultiplier *= 10;
          costPteroStrike = Math.floor(costPteroStrike * 4);
          document.getElementById('costPteroStrike').textContent = costPteroStrike;
          playUpgradeSound();
          updateScore();
        } else alertDino("You need more bones for Pterodactyl Strike!");
        break;
      case 'stegoShield':
        if(score >= costStegoShield) {
          score -= costStegoShield;
          clickPower += 200;
          costStegoShield = Math.floor(costStegoShield * 4);
          document.getElementById('costStegoShield').textContent = costStegoShield;
          playUpgradeSound();
          updateScore();
        } else alertDino("Not enough bones for Stegosaurus Shield!");
        break;
      case 'fossilFuel':
        if(score >= costFossilFuel) {
          score -= costFossilFuel;
          autoClickers += 50;
          costFossilFuel = Math.floor(costFossilFuel * 3.5);
          document.getElementById('costFossilFuel').textContent = costFossilFuel;
          playUpgradeSound();
          updateScore();
        } else alertDino("Bones insufficient for Fossil Fuel Auto-Stomp!");
        break;
      case 'meteorShower':
        if(score >= costMeteorShower) {
          score -= costMeteorShower;
          clickMultiplier *= 20;
          costMeteorShower = Math.floor(costMeteorShower * 5);
          document.getElementById('costMeteorShower').textContent = costMeteorShower;
          playUpgradeSound();
          updateScore();
        } else alertDino("Gather more bones for Meteor Shower!");
        break;
      case 'volcanoPower':
        if(score >= costVolcanoPower) {
          score -= costVolcanoPower;
          clickPower += 1000;
          costVolcanoPower = Math.floor(costVolcanoPower * 5);
          document.getElementById('costVolcanoPower').textContent = costVolcanoPower;
          playUpgradeSound();
          updateScore();
        } else alertDino("Bones missing for Volcano Power!");
        break;
    }
  }

  // Event listeners for upgrades
  document.getElementById('upgradeClawPower').addEventListener('click', () => buyUpgrade('clawPower'));
  document.getElementById('buyBabyHelper').addEventListener('click', () => buyUpgrade('babyHelper'));
  document.getElementById('buyRaptorRage').addEventListener('click', () => buyUpgrade('raptorRage'));
  document.getElementById('buyTRexBite').addEventListener('click', () => buyUpgrade('tRexBite'));
  document.getElementById('buyDinoHerd').addEventListener('click', () => buyUpgrade('dinoHerd'));
  document.getElementById('buyAncientRoar').addEventListener('click', () => buyUpgrade('ancientRoar'));
  document.getElementById('buyMeteorSmash').addEventListener('click', () => buyUpgrade('meteorSmash'));
  document.getElementById('buyDinoAlpha').addEventListener('click', () => buyUpgrade('dinoAlpha'));
  document.getElementById('buyPteroStrike').addEventListener('click', () => buyUpgrade('pteroStrike'));
  document.getElementById('buyStegoShield').addEventListener('click', () => buyUpgrade('stegoShield'));
  document.getElementById('buyFossilFuel').addEventListener('click', () => buyUpgrade('fossilFuel'));
  document.getElementById('buyMeteorShower').addEventListener('click', () => buyUpgrade('meteorShower'));
  document.getElementById('buyVolcanoPower').addEventListener('click', () => buyUpgrade('volcanoPower'));

  clickButton.addEventListener('click', clickDino);

  // Auto clickers add clicks every second
  setInterval(() => {
    if(autoClickers > 0) {
      score += autoClickers * clickPower * clickMultiplier;
      updateScore();
    }
  }, 1000);

  // --- Online leaderboard with JSONBin.io ---

  // Replace these with your JSONBin.io credentials
  const API_BIN_ID = "YOUR_BIN_ID_HERE";
  const API_BIN_SECRET = "YOUR_SECRET_KEY_HERE";
  const API_URL = `https://api.jsonbin.io/v3/b/${API_BIN_ID}/latest`;

  let leaderboard = [];

  function displayLeaderboard() {
    leaderboardList.innerHTML = '';
    leaderboard.slice(0,5).forEach(entry => {
      const li = document.createElement('li');
      li.textContent = `${entry.name} - ${entry.score}`;
      leaderboardList.appendChild(li);
    });
  }

  async function loadLeaderboard() {
    try {
      const res = await fetch(API_URL, {
        headers: { 'X-Master-Key': API_BIN_SECRET }
      });
      if (!res.ok) throw new Error('Failed to load leaderboard');
      const data = await res.json();
      // Access leaderboard array inside "leaderboard" key
      leaderboard = data.record.leaderboard || [];
      leaderboard.sort((a,b) => b.score - a.score);
      displayLeaderboard();
    } catch (e) {
      console.error(e);
      leaderboardList.innerHTML = '<li>Failed to load leaderboard</li>';
    }
  }

  async function submitScore() {
    const name = nameInput.value.trim();
    if(!name) {
      alertDino('Please enter your dino name');
      return;
    }
    if(personalHighscore === 0) {
      alertDino('Score must be greater than 0');
      return;
    }
    submitMessage.style.color = 'black';
    submitMessage.textContent = 'Roaring... Submitting score!';

    try {
      // Fetch current scores
      const res = await fetch(API_URL, {
        headers: { 'X-Master-Key': API_BIN_SECRET }
      });
      if(!res.ok) throw new Error('Could not fetch leaderboard');
      const data = await res.json();
      let currentScores = data.record.leaderboard || [];

      // Add or update player score
      const existingIndex = currentScores.findIndex(e => e.name === name);
      if(existingIndex >= 0) {
        if(personalHighscore > currentScores[existingIndex].score) {
          currentScores[existingIndex].score = personalHighscore;
        }
      } else {
        currentScores.push({ name: name, score: personalHighscore });
      }

      // Sort descending and keep top 50
      currentScores.sort((a,b) => b.score - a.score);
      if(currentScores.length > 50) currentScores.length = 50;

      // Update the bin with the leaderboard object wrapper
      const updateRes = await fetch(`https://api.jsonbin.io/v3/b/${API_BIN_ID}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': API_BIN_SECRET,
          'X-Bin-Versioning': 'false'
        },
        body: JSON.stringify({ leaderboard: currentScores })
      });

      if(!updateRes.ok) throw new Error('Failed to update leaderboard');

      leaderboard = currentScores;
      displayLeaderboard();
      submitMessage.style.color = 'green';
      submitMessage.textContent = 'Score submitted successfully! 🦖';

    } catch(e) {
      submitMessage.style.color = 'red';
      submitMessage.textContent = 'Failed to submit score. Try again later.';
      console.error(e);
    }
  }

  submitScoreBtn.addEventListener('click', submitScore);

  loadLeaderboard();
  highscoreDisplay.textContent = 'Personal Highscore: ' + personalHighscore;
  updateScore();
</script>

</body>
</html>
